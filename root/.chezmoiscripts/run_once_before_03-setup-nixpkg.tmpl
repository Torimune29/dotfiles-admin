#!/usr/bin/env sh

set -eu

# nixpkg
{{ if not (lookPath "nix") }}

mkdir -p /nix /etc/nix && chmod a+rwx /nix

{{ if and
  .isWsl
  (not .isDocker) }}
# if wsl, should use nixos-wsl
cat <<EOF
#################################################################
Systemd will enable after reboot wsl.
If rebooted, type this to install nixpkg:

$ sh -c "\$(curl -L https://nixos.org/nix/install)" -- --daemon
$ sudo chown -R {{ .nixpkgUser }}. /nix/var/nix/gcroots
$ sudo chown -R {{ .nixpkgUser }}. /nix/var/nix/profiles

#################################################################
EOF
{{ else }}
# install nixpkg
bash -c "$(curl -L https://nixos.org/nix/install)" -- --daemon
{{   if .isDocker }}
echo 'sandbox = false' | sudo tee -a /etc/nix/nix.conf > /dev/null
{{   end }}

{{ end }}

{{ end }}
