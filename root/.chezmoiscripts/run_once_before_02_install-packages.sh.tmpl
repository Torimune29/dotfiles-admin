#!/usr/bin/env sh

set -eu

{{- $repositorySpecific := dict
  "apt" "xz-utils passwd"
  "yum" "xz passwd"
  "dnf" "xz passwd"
  "apk" "xz shadow"
-}}

{{- $requestPackages := cat
  "git"
  "curl"
  "ca-certificates"
  "bash"
  "bash-completion"
  "sudo"
  "tar"
  "python3"
  (get $repositorySpecific .packageManager)
-}}

{{ template "sudo" cat .install $requestPackages }}

curl -L -o nix_install.sh https://nixos.org/nix/install
sh nix_install.sh --daemon
rm nix_install.sh
